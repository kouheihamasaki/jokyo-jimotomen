<div class="container">
  <div class="row">

  <div class ="col-9">
    <div class ="row">
      <h3 class="mt-3 midashi">
        <%= @post.title %>
      </h3>
    </div>
    <div class ="row mt-2">
      <small><%= @post.created_at.strftime('%Y/%m/%d') %>„ÄÄ</small>
      <small class="text-muted">„ÄÄüí¨<%= @post.post_comment.count %></small>
      <small class="text-muted">„ÄÄüíõ<%= @post.favorite.count %></small>
    </div>
    <div class ="row">
      <%= image_tag @post.get_image(800,1200) %>
    </div>
    <div class ="row mt-2">
    <h4>Ë©ï‰æ°„ÄÄ</h4>
    <div id="show-stars"></div>
      <h4 class="font-red">„ÄÄÊòü<%= @post.star %>„ÉÑÔºÅ</h4>
    </div>
      <script>
        let showRateElement = document.querySelector('#show-stars');
        let showOpt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        scoreName: 'post[star]',
        score: "<%= @post.star %>",
        readOnly: true
        };
        window.raty(showRateElement, showOpt);
      </script>
    <div class="row">
      <% @post.tags.each do |tag| %>
        <span><%= tag.name %></span>
      <% end %>
    </div>
    <p class="mt-3"><%= simple_format(@post.body) %></p>
    <div class ="row">
      <table class="table table-bordered mt-3">
        <tr>
          <td>ÊäïÁ®øËÄÖ</td>
          <td>
            <%= image_tag @post.user.get_profile_image(40,40) %>
            <%= @post.user.screen_name %>
          </td>
        </tr>
        <tr>
          <td class="mt-3">„Ç∑„Éß„ÉÉ„ÉóÂêç</td>
          <td><%= @post.shop_name %></td>
        </tr>
        <tr>
          <td>‰ΩèÊâÄ</td>
          <td><%= @post.adress %></td>
        </tr>
      </table>
    </div>

    <div id="map" style="height: 400px;"></div>
    <script>
    function initMap(){
      let mapPosition = {lat: <%= @post.latitude || 0 %> , lng: <%= @post.longitude || 0 %> };
      let map = new google.maps.Map(document.getElementById('map'), {
        zoom: 15,
        center: mapPosition
      });
      let transitLayer = new google.maps.TransitLayer();
      transitLayer.setMap(map);

      let contentString = '„Äê‰ΩèÊâÄ„Äë<%= @post.adress %>';
      let infowindow = new google.maps.InfoWindow({
        content: contentString
      });

      let marker = new google.maps.Marker({
        position: mapPosition,
        map: map,
        title: contentString
      });

      marker.addListener('click', function(){
        infowindow.open(map, marker);
      });
    }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&callback=initMap" async defer></script>

    <div class="mt-2">
      <% if @post.favorited_by?(current_user) %>
      <p>
        <%= link_to post_favorites_path(@post), method: :delete do %>
          ‚ô•<%= @post.favorite.count %> „ÅÑ„ÅÑ„Å≠
        <% end %>
      </p>
      <% else %>
      <p>
        <%= link_to post_favorites_path(@post), method: :post do %>
          ‚ô°<%= @post.favorite.count %> „ÅÑ„ÅÑ„Å≠
        <% end %>
      </p>
      <% end %>
    </div>


    <div>
      <p>„Ç≥„É°„É≥„Éà‰ª∂Êï∞Ôºö<%= @post.post_comment.count %></p>
      <% @post.post_comment.each do |post_comment| %>
        <h6>
          <%= post_comment.user.screen_name %>
          <%= post_comment.created_at.strftime('%Y/%m/%d') %>
        </h6>
        <p>
          <%= post_comment.comment %>
        </p>
        <% if post_comment.user == current_user %>
          <%= link_to "„Åì„ÅÆ„Ç≥„É°„É≥„Éà„ÇíÂâäÈô§„Åô„Çã", post_post_comment_path(post_comment.post, post_comment), method: :delete %>
        <% end %>
      <% end %>
    </div>

    <div>
      <%= form_with model: [@post, @post_comment] do |f| %>
       <%= f.text_area :comment, rows: '2', placeholder: "„Ç≥„É°„É≥„Éà„Çí„Åì„Åì„Å´" %>
       <%= f.submit "ÈÄÅ‰ø°„Åô„Çã" %>
      <% end %>
    </div>


          <% if @post.user == current_user %>
        <%= link_to "ÂâäÈô§", post_path(@post), method: :delete %>
      <% end %>


  </div>

    <%= render 'public/homes/sidebar', user: @user %>



  </div>
</div>
